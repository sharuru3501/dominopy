# DominoPy 使用方法ガイド

## 🚀 アプリケーションの起動

```bash
# 仮想環境を有効化
source venv/bin/activate

# アプリケーションを起動
python run_app.py
# または
python -m src.main
```

## 🎵 編集モード

### ノート入力モード（デフォルト）
**切り替え**: ツールバーの🎵ボタン / キー `1`

- **音符作成**: 空のセルをクリック
- **音符移動**: 音符をドラッグ
- **音符リサイズ**: 音符の端をドラッグ
- **音符削除**: 右クリック または `Delete`/`Backspace`

### 選択モード
**切り替え**: ツールバーの📐ボタン / キー `2`

- **音符選択**: 音符をクリック（トグル）
- **矩形選択**: 空のエリアをドラッグ
- **グリッドセル選択**: `Ctrl`+クリック
- **ペースト位置指定**: `Shift`+クリック

## ⌨️ キーボードショートカット

### 基本操作
- `Ctrl+C` - コピー
- `Ctrl+X` - カット
- `Ctrl+V` - ペースト
- `Ctrl+Z` - 元に戻す
- `Ctrl+Y` - やり直し
- `Ctrl+A` - 全選択

### 再生操作
- `Space` - 再生/一時停止（トグル）

### モード切り替え
- `1` - ノート入力モード
- `2` - 選択モード
- `Tab` - モード切り替え

## 🎵 新機能: 音楽理論サポート

### 音名・コード名表示
DominoPyの上部ツールバーには、音符の音名やコード名がリアルタイムで表示されます：

#### 表示内容
- **単音表示**: C4, D#5 など、音名とオクターブを表示
- **コード検出**: C, Am, F, G7 など、一般的なコードを自動認識
- **カスタム和音**: 認識できない和音は "Custom" と表示

#### 表示タイミング
- **再生中**: 再生ヘッド位置で現在演奏されている音符・コードを表示
- **停止中**: 選択している音符の情報を表示
- **空の時**: "No notes" / "No chord" を表示

#### 対応コード
- **メジャーコード**: C, D, E, F, G, A, B
- **マイナーコード**: Cm, Dm, Em, Fm, Gm, Am, Bm  
- **7thコード**: C7, Dm7, Em7, Fmaj7, G7, Am7, Bm7b5
- **その他**: sus2, sus4, aug, dim, add9

### テンポ・拍子制御
上部ツールバーから音楽の基本設定をコントロールできます：

- **テンポ設定**: 20-300 BPMの範囲で設定可能
- **拍子設定**: 4/4, 3/4, 6/8 など一般的な拍子に対応
- **メトロノーム**: ビジュアル拍子ガイド（🥁アイコンで切り替え）
- **リアルタイム変更**: 再生中でもテンポ・拍子の変更が可能

### 再生情報表示
上部ツールバーの右側には再生情報が表示されます：

- **再生状態**: ⏹️停止、▶️再生、⏸️一時停止
- **再生位置**: 分:秒形式で現在位置を表示

### 音符編集
- `Delete` / `Backspace` - 選択した音符を削除
- `右クリック` - 音符を削除（ノート入力モード）

## 🔊 オーディオ機能

### 音の再生
ノート入力時に自動的に音が再生されます：

- **ノート作成**: 空のセルをクリックすると音が鳴る
- **音量**: デフォルトベロシティ100で再生
- **再生時間**: 約0.5秒間のプレビュー再生

### シーケンス再生
作成した音符を順番に再生できます：

- **▶️ 再生ボタン**: シーケンスを再生開始
- **⏸️ 一時停止**: 再生を一時停止（再び押すと再開）
- **⏹️ 停止**: 再生を停止して先頭に戻る
- **⏮️ 先頭**: 再生位置を先頭に戻す

### 再生ヘッド
- **赤い縦線**: 現在の再生位置を表示
- **三角マーカー**: 再生ヘッドの位置を示す
- **リアルタイム**: 再生中は滑らかに移動

### オーディオ設定
- **Audio > Test Audio (C4)**: オーディオシステムをテスト
- **MIDI出力**: システムのMIDI出力デバイスを使用
- **クロスプラットフォーム**: Windows、macOS、Linux対応

## 🔧 高度な機能

### グリッドセル選択
選択モードで空のセルを操作できます：

- **通常クリック**: 矩形選択開始
- **Ctrl+クリック**: セルの選択/選択解除（トグル）
- **Shift+クリック**: ペースト位置を指定

### ペースト機能
ペーストは以下の優先順位で位置を決定します：

1. **ペースト位置指定** (Shift+クリック で設定)
2. **選択中の音符位置**
3. **選択中のグリッドセル位置**
4. **デフォルト位置** (tick 0)

### 複数選択
- **音符選択**: 選択モードで音符をクリック
- **矩形選択**: 選択モードでドラッグ
- **グリッドセル選択**: Ctrl+クリック

## 🎨 UI要素

### ツールバー
- 🎵 **ノート入力** - 音符の作成・編集
- 📐 **選択** - 音符・セルの選択
- ⇄ **モード切り替え** - 2つのモードを切り替え

### 視覚的インジケーター
- **右上**: 現在のモード表示
- **青色矩形**: 選択されたグリッドセル
- **オレンジ色矩形**: ペースト位置指定
- **黄色音符**: 選択された音符
- **点線矩形**: 矩形選択エリア

## 📁 ファイル操作

### 対応形式
- **読み込み**: `.mid`, `.midi` ファイル
- **保存**: 今後実装予定

### 使用方法
1. `File` → `Open...` でMIDIファイルを読み込み
2. 編集を行う
3. `Ctrl+S` で保存（今後実装予定）

## 🔄 操作の流れ

### 基本的な編集
1. **ノート入力モード**で音符を作成
2. **選択モード**で音符を選択
3. `Ctrl+C` でコピー
4. `Shift+クリック` でペースト位置指定
5. `Ctrl+V` でペースト

### カット&ペースト
1. **選択モード**で音符を選択
2. `Ctrl+X` でカット
3. `Shift+クリック` でペースト位置指定
4. `Ctrl+V` でペースト

## 🎯 使用例

### 1. メロディの複製
```
1. ノート入力モードでメロディを作成
2. 選択モードに切り替え（Tab）
3. 矩形選択でメロディを選択
4. Ctrl+C でコピー
5. Shift+クリックで別の位置を指定
6. Ctrl+V でペースト
```

### 2. 音符の移動
```
1. 選択モードで音符を選択
2. Ctrl+X でカット
3. Shift+クリックで新しい位置を指定
4. Ctrl+V でペースト
```

### 3. グリッドベースの編集
```
1. 選択モードでCtrl+クリックしてセルを選択
2. 選択したセルに音符を配置
3. Shift+クリックでペースト位置を指定
```

## 🔧 トラブルシューティング

### アプリケーションが起動しない
```bash
# 依存関係の確認
source venv/bin/activate
pip install -r requirements.txt
```

### 操作が効かない
- ピアノロールにフォーカスがあることを確認
- 正しいモードになっていることを確認
- 選択状態を確認

### 音符が見えない
- ズーム設定を確認
- 表示範囲を確認
- MIDIファイルが正しく読み込まれているか確認

## 📚 今後の機能

- MIDIファイル保存
- 複数トラック対応
- 楽器選択
- 再生機能
- 録音機能
- エフェクト機能